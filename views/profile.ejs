<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= user.firstName %> <%= user.lastName %> Profile page</title>
  <style>
    body { font-family: 'Trebuchet MS', Arial, sans-serif; background: #f4f4f4; }
    a {
      text-decoration: none;
      color: #203a43;
    }
    nav {
      background: #7CC3E3;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 8px #0002;
      position: relative;
    }
    
    .MenuIcon {
      color: black;
    }

    .fa-user {
      position: absolute;
      right: 10px;
      top: 5px;
      font-size: 33px;
      border-radius: 50%;
      border: 2px solid rgb(243, 239, 239);
      box-shadow: 10px 2px 8px #0002;
      cursor: pointer;
    }
    .fa-user:hover {
      scale: 1.5;
      transition: scale 0.2s ease-in-out;
    }
    .profile-container {
      max-width: 400px;
      margin: 40px auto;
      padding: 30px;
      border-radius: 15px;
      background: #fff;
      box-shadow: 0 2px 8px #0002;
      text-align: center;
    }
    header h2 { color: #203a43; text-align: center;}
    header nav ul {
      list-style: none;
      padding: 0;
      display: flex;
      justify-content: center;
      place-content: flex-start;
      gap: 20px;
    }
    .profile-container p { margin: 10px 0; }

    .logout-btn {
      margin-top: 20px;
      padding: 8px 20px;
      border: none;
      border-radius: 5px;
      background: #7CC3E3;
      color: #fff;
      cursor: pointer;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      background: #fff;
      box-shadow: 0 -2px 8px #0002;
      padding: 10px 0;
    }

    .toggle-icon {
      display: block;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
      font-size: 16px;
      width: 20px;
      height: 20px;
      transition: background 0.4s, color 0.4s, filter 0.4s;
      border-radius: 50%;
      background: #eee;
      cursor: pointer;
    }

    .toggle-on {
      background: #4caf50 !important;
      color: #fff !important;
      filter: drop-shadow(0 0 4px #4caf50);
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <button id="nav-toggle" aria-label="Toggle navigation" style="background:none;border:none;cursor:pointer;font-size:1.5em;">
        <img src="../images/bars-solid.svg" class="MenuIcon" style="width:1.5em;height:1.5em;display:inline;">
      </button>
      <img src="../images/<%= user.profilePicture ? user.profilePicture : 'user-solid.svg' %>" class="fa-user" style="width:1.5em;height:1.5em;display:inline;">
      <ul id="nav-menu" style="display:none;flex-direction:column;align-items:center;gap:20px;margin-top:10px;">
      
      <li><a href="/profile/<%= user.userName %>">Profile</a></li>
      <li><a href="/settings?username=<%= user.userName %>">Settings</a></li>
      <li><a href="/help">Help</a></li>
      <li><a href="http://localhost:5500/practice.html">Logout</a></li>
      <li><a href="#" id="delete-account-link">Delete Account</a></li>
      </ul>
    </nav>
    
    <h2>Welcome, <%= user.firstName %> <%= user.lastName %></h2>
  </header>
  <img src="../images/toggle-off-solid.svg" class="toggle-icon" id="toggleSwitch">
  <main>
    <div class="profile-container">
      <p><strong>Username:</strong> <%= user.userName %></p>
      <p><strong>Email:</strong> <%= user.email %></p>
      <p><strong>Phone:</strong> <%= user.phoneNo %></p>
      <button class="logout-btn" type="submit">Logout</button>
    </div>
    
  </main>
  <footer>
     <small>creation of Egbebo Tamarauemomoemi Emmanuel Â© 2025</small>
  </footer>
  <script src="https://kit.fontawesome.com/cfd133c1e6.js" crossorigin="anonymous"></script>
  <script>
    document.querySelector('.logout-btn').addEventListener('click', () => {
      window.location.href = `http://localhost:5500/practice.html`;
      alert(`You have successfully logged out`)
    })

    // Toggle switch logic
    const toggleSwitch = document.getElementById('toggleSwitch');
    let toggleOn = false;
    toggleSwitch.addEventListener('click', function() {
      toggleOn = !toggleOn;
      if (toggleOn) {
        this.src = '../images/toggle-on-solid.svg';
        this.classList.add('toggle-on');
        document.body.style.background = '#203a43';
        document.body.style.color = '#fff';
        document.querySelector('.profile-container').style.color = 'white'
        document.querySelector('.profile-container').style.background = 'inherit';
        document.querySelector('h2').style.color = 'white';
        document.querySelector('footer').style.color = 'black';
        document.querySelector('footer').style.background = '#203a43';
      } else {
        this.src = '../images/toggle-off-solid.svg'
        this.classList.remove('toggle-on');
        document.body.style.background = '#f4f4f4'
        document.body.style.color = '#203a43'
        document.querySelector('.profile-container').style.color = 'black'
        document.querySelector('h2').style.color = 'black'
        document.querySelector('footer').style.color = 'black'
        document.querySelector('footer').style.background = '#fff';
      }
    });

    let isClicked = false;
    const navToggle = document.querySelector('#nav-toggle');
    const navMenu = document.getElementById('nav-menu');
    navToggle.addEventListener('click', () => {
      isClicked = !isClicked
      navMenu.style.display = navMenu.style.display === 'none' ? 'flex' : 'none';
      if(isClicked) document.querySelector('.MenuIcon').src = '../images/xmark-solid.svg'
      else document.querySelector('.MenuIcon').src = '../images/bars-solid.svg'
    });

    document.getElementById('delete-account-link').addEventListener('click', function(e) {
      e.preventDefault();
      if (!confirm('Are you sure you want to delete your account? This action cannot be undone.')) return;
      fetch(`/delete-account/<%= user.userName %>`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Account deleted successfully.');
          window.location.href = 'http://localhost:5500/practice.html';
        } else {
          alert('Error: ' + (data.message || 'Could not delete account.'));
        }
      })
      .catch(() => alert('Server error. Please try again.'));
    });
  </script>
</body>
</html>
